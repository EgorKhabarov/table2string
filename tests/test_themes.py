from table2string import Table, Themes, Theme, Color


def test_themes():
    table = Table(
        [
            ("1", "2", "3"),
            ("3", Table([("4.1", "4.2"), ("4.3", "4.4")]), "5"),
            ("6", "7", "8"),
            ("9", "10", "11"),
            (
                Table([("1",), (Table([("2", "3")]),)]),
                Table([(Table([("2", "3")]),), ("1",)]),
                "14",
            ),
            (
                "15",
                Table([("1", Table([("2",), ("3",)]))]),
                Table([(Table([("2",), ("3",)]), "1")]),
            ),
        ],
    )

    assert (
        table.stringify(theme=Themes.ascii_booktabs)
        == """
 --------------------------- 
      1           2       3  
 =========================== 
      3   4.1   4.2       5  
         ===========         
          4.3   4.4          
 --------------------------- 
      6           7       8  
 --------------------------- 
      9          10      11  
 --------------------------- 
      1     2     3      14  
 ======= ===========         
  2   3           1          
 --------------------------- 
     15     1     2   2   1  
               ===== ===     
                  3   3      
 --------------------------- 
""".strip(
            "\n"
        )
    )
    assert (
        table.stringify(theme=Themes.ascii_double)
        == """
+=======+===========+=======+
‖     1 ‖         2 ‖     3 ‖
+=======+=====+=====+=======+
‖     3 ‖ 4.1 ‖ 4.2 ‖     5 ‖
‖       +=====+=====+       ‖
‖       ‖ 4.3 ‖ 4.4 ‖       ‖
+=======+=====+=====+=======+
‖     6 ‖         7 ‖     8 ‖
+=======+===========+=======+
‖     9 ‖        10 ‖    11 ‖
+=======+=====+=====+=======+
‖     1 ‖   2 ‖   3 ‖    14 ‖
+===+===+=====+=====+       ‖
‖ 2 ‖ 3 ‖         1 ‖       ‖
+===+===+=====+=====+===+===+
‖    15 ‖   1 ‖   2 ‖ 2 ‖ 1 ‖
‖       ‖     +=====+===+   ‖
‖       ‖     ‖   3 ‖ 3 ‖   ‖
+=======+=====+=====+===+===+
""".strip()
    )
    assert (
        table.stringify(theme=Themes.ascii_double_thin)
        == """
+=======+===========+=======+
‖     1 ‖         2 ‖     3 ‖
+-------+-----+-----+-------+
‖     3 ‖ 4.1 ‖ 4.2 ‖     5 ‖
‖       +=====+=====+       ‖
‖       ‖ 4.3 ‖ 4.4 ‖       ‖
+=======+=====+=====+=======+
‖     6 ‖         7 ‖     8 ‖
+=======+===========+=======+
‖     9 ‖        10 ‖    11 ‖
+=======+=====+=====+=======+
‖     1 ‖   2 ‖   3 ‖    14 ‖
+===+===+=====+=====+       ‖
‖ 2 ‖ 3 ‖         1 ‖       ‖
+===+===+=====+=====+===+===+
‖    15 ‖   1 ‖   2 ‖ 2 ‖ 1 ‖
‖       ‖     +=====+===+   ‖
‖       ‖     ‖   3 ‖ 3 ‖   ‖
+=======+=====+=====+===+===+
""".strip()
    )
    assert (
        table.stringify(theme=Themes.ascii_thin)
        == """
+-------+-----------+-------+
|     1 |         2 |     3 |
+-------+-----+-----+-------+
|     3 | 4.1 | 4.2 |     5 |
|       +-----+-----+       |
|       | 4.3 | 4.4 |       |
+-------+-----+-----+-------+
|     6 |         7 |     8 |
+-------+-----------+-------+
|     9 |        10 |    11 |
+-------+-----+-----+-------+
|     1 |   2 |   3 |    14 |
+---+---+-----+-----+       |
| 2 | 3 |         1 |       |
+---+---+-----+-----+---+---+
|    15 |   1 |   2 | 2 | 1 |
|       |     +-----+---+   |
|       |     |   3 | 3 |   |
+-------+-----+-----+---+---+
""".strip()
    )
    assert (
        table.stringify(theme=Themes.ascii_thin_double)
        == """
+-------+-----------+-------+
|     1 |         2 |     3 |
+=======+=====+=====+=======+
|     3 | 4.1 | 4.2 |     5 |
|       +-----+-----+       |
|       | 4.3 | 4.4 |       |
+-------+-----+-----+-------+
|     6 |         7 |     8 |
+-------+-----------+-------+
|     9 |        10 |    11 |
+-------+-----+-----+-------+
|     1 |   2 |   3 |    14 |
+---+---+-----+-----+       |
| 2 | 3 |         1 |       |
+---+---+-----+-----+---+---+
|    15 |   1 |   2 | 2 | 1 |
|       |     +-----+---+   |
|       |     |   3 | 3 |   |
+-------+-----+-----+---+---+
""".strip()
    )
    assert (
        table.stringify(theme=Themes.booktabs)
        == """
 ─────────────────────────── 
      1           2       3  
 ━━━━━━━━━━━━━━━━━━━━━━━━━━━ 
      3   4.1   4.2       5  
         ━━━━━━━━━━━         
          4.3   4.4          
 ─────────────────────────── 
      6           7       8  
 ─────────────────────────── 
      9          10      11  
 ─────────────────────────── 
      1     2     3      14  
 ━━━━━━━ ━━━━━━━━━━━         
  2   3           1          
 ─────────────────────────── 
     15     1     2   2   1  
               ━━━━━ ━━━     
                  3   3      
 ─────────────────────────── 
""".strip(
            "\n"
        )
    )
    assert (
        table.stringify(theme=Themes.double)
        == """
╔═══════╦═══════════╦═══════╗
║     1 ║         2 ║     3 ║
╠═══════╬═════╦═════╬═══════╣
║     3 ║ 4.1 ║ 4.2 ║     5 ║
║       ╠═════╬═════╣       ║
║       ║ 4.3 ║ 4.4 ║       ║
╠═══════╬═════╩═════╬═══════╣
║     6 ║         7 ║     8 ║
╠═══════╬═══════════╬═══════╣
║     9 ║        10 ║    11 ║
╠═══════╬═════╦═════╬═══════╣
║     1 ║   2 ║   3 ║    14 ║
╠═══╦═══╬═════╩═════╣       ║
║ 2 ║ 3 ║         1 ║       ║
╠═══╩═══╬═════╦═════╬═══╦═══╣
║    15 ║   1 ║   2 ║ 2 ║ 1 ║
║       ║     ╠═════╬═══╣   ║
║       ║     ║   3 ║ 3 ║   ║
╚═══════╩═════╩═════╩═══╩═══╝
""".strip()
    )
    assert (
        table.stringify(theme=Themes.double_thin)
        == """
╔═══════╦═══════════╦═══════╗
║     1 ║         2 ║     3 ║
╟───────╫─────╥─────╫───────╢
║     3 ║ 4.1 ║ 4.2 ║     5 ║
║       ╠═════╬═════╣       ║
║       ║ 4.3 ║ 4.4 ║       ║
╠═══════╬═════╩═════╬═══════╣
║     6 ║         7 ║     8 ║
╠═══════╬═══════════╬═══════╣
║     9 ║        10 ║    11 ║
╠═══════╬═════╦═════╬═══════╣
║     1 ║   2 ║   3 ║    14 ║
╠═══╦═══╬═════╩═════╣       ║
║ 2 ║ 3 ║         1 ║       ║
╠═══╩═══╬═════╦═════╬═══╦═══╣
║    15 ║   1 ║   2 ║ 2 ║ 1 ║
║       ║     ╠═════╬═══╣   ║
║       ║     ║   3 ║ 3 ║   ║
╚═══════╩═════╩═════╩═══╩═══╝
""".strip()
    )
    assert (
        table.stringify(theme=Themes.markdown)
        == """
|     1 |         2 |     3 |
|-------|-----------|-------|
|     3 | 4.1 | 4.2 |     5 |
|       |-----+-----|       |
|       | 4.3 | 4.4 |       |
|     6 |         7 |     8 |
|     9 |        10 |    11 |
|     1 |   2 |   3 |    14 |
|---+---|-----+-----|       |
| 2 | 3 |         1 |       |
|    15 |   1 |   2 | 2 | 1 |
|       |     +-----|---+   |
|       |     |   3 | 3 |   |
""".strip()
    )
    assert (
        table.stringify(theme=Themes.rounded)
        == """
╭───────┬───────────┬───────╮
│     1 │         2 │     3 │
├───────┼─────┬─────┼───────┤
│     3 │ 4.1 │ 4.2 │     5 │
│       ├─────┼─────┤       │
│       │ 4.3 │ 4.4 │       │
├───────┼─────┴─────┼───────┤
│     6 │         7 │     8 │
├───────┼───────────┼───────┤
│     9 │        10 │    11 │
├───────┼─────┬─────┼───────┤
│     1 │   2 │   3 │    14 │
├───┬───┼─────┴─────┤       │
│ 2 │ 3 │         1 │       │
├───┴───┼─────┬─────┼───┬───┤
│    15 │   1 │   2 │ 2 │ 1 │
│       │     ├─────┼───┤   │
│       │     │   3 │ 3 │   │
╰───────┴─────┴─────┴───┴───╯
""".strip()
    )
    assert (
        table.stringify(theme=Themes.rounded_double)
        == """
╭───────┬───────────┬───────╮
│     1 │         2 │     3 │
╞═══════╪═════╤═════╪═══════╡
│     3 │ 4.1 │ 4.2 │     5 │
│       ├─────┼─────┤       │
│       │ 4.3 │ 4.4 │       │
├───────┼─────┴─────┼───────┤
│     6 │         7 │     8 │
├───────┼───────────┼───────┤
│     9 │        10 │    11 │
├───────┼─────┬─────┼───────┤
│     1 │   2 │   3 │    14 │
├───┬───┼─────┴─────┤       │
│ 2 │ 3 │         1 │       │
├───┴───┼─────┬─────┼───┬───┤
│    15 │   1 │   2 │ 2 │ 1 │
│       │     ├─────┼───┤   │
│       │     │   3 │ 3 │   │
╰───────┴─────┴─────┴───┴───╯
""".strip()
    )
    assert (
        table.stringify(theme=Themes.rounded_thick)
        == """
╭───────┬───────────┬───────╮
│     1 │         2 │     3 │
┝━━━━━━━┿━━━━━┯━━━━━┿━━━━━━━┥
│     3 │ 4.1 │ 4.2 │     5 │
│       ├─────┼─────┤       │
│       │ 4.3 │ 4.4 │       │
├───────┼─────┴─────┼───────┤
│     6 │         7 │     8 │
├───────┼───────────┼───────┤
│     9 │        10 │    11 │
├───────┼─────┬─────┼───────┤
│     1 │   2 │   3 │    14 │
├───┬───┼─────┴─────┤       │
│ 2 │ 3 │         1 │       │
├───┴───┼─────┬─────┼───┬───┤
│    15 │   1 │   2 │ 2 │ 1 │
│       │     ├─────┼───┤   │
│       │     │   3 │ 3 │   │
╰───────┴─────┴─────┴───┴───╯
""".strip()
    )
    assert (
        table.stringify(theme=Themes.thick)
        == """
┏━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┓
┃     1 ┃         2 ┃     3 ┃
┣━━━━━━━╋━━━━━┳━━━━━╋━━━━━━━┫
┃     3 ┃ 4.1 ┃ 4.2 ┃     5 ┃
┃       ┣━━━━━╋━━━━━┫       ┃
┃       ┃ 4.3 ┃ 4.4 ┃       ┃
┣━━━━━━━╋━━━━━┻━━━━━╋━━━━━━━┫
┃     6 ┃         7 ┃     8 ┃
┣━━━━━━━╋━━━━━━━━━━━╋━━━━━━━┫
┃     9 ┃        10 ┃    11 ┃
┣━━━━━━━╋━━━━━┳━━━━━╋━━━━━━━┫
┃     1 ┃   2 ┃   3 ┃    14 ┃
┣━━━┳━━━╋━━━━━┻━━━━━┫       ┃
┃ 2 ┃ 3 ┃         1 ┃       ┃
┣━━━┻━━━╋━━━━━┳━━━━━╋━━━┳━━━┫
┃    15 ┃   1 ┃   2 ┃ 2 ┃ 1 ┃
┃       ┃     ┣━━━━━╋━━━┫   ┃
┃       ┃     ┃   3 ┃ 3 ┃   ┃
┗━━━━━━━┻━━━━━┻━━━━━┻━━━┻━━━┛
""".strip()
    )
    assert (
        table.stringify(theme=Themes.thick_thin)
        == """
┏━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┓
┃     1 ┃         2 ┃     3 ┃
┠───────╂─────┰─────╂───────┨
┃     3 ┃ 4.1 ┃ 4.2 ┃     5 ┃
┃       ┣━━━━━╋━━━━━┫       ┃
┃       ┃ 4.3 ┃ 4.4 ┃       ┃
┣━━━━━━━╋━━━━━┻━━━━━╋━━━━━━━┫
┃     6 ┃         7 ┃     8 ┃
┣━━━━━━━╋━━━━━━━━━━━╋━━━━━━━┫
┃     9 ┃        10 ┃    11 ┃
┣━━━━━━━╋━━━━━┳━━━━━╋━━━━━━━┫
┃     1 ┃   2 ┃   3 ┃    14 ┃
┣━━━┳━━━╋━━━━━┻━━━━━┫       ┃
┃ 2 ┃ 3 ┃         1 ┃       ┃
┣━━━┻━━━╋━━━━━┳━━━━━╋━━━┳━━━┫
┃    15 ┃   1 ┃   2 ┃ 2 ┃ 1 ┃
┃       ┃     ┣━━━━━╋━━━┫   ┃
┃       ┃     ┃   3 ┃ 3 ┃   ┃
┗━━━━━━━┻━━━━━┻━━━━━┻━━━┻━━━┛
""".strip()
    )
    assert (
        table.stringify(theme=Themes.thin)
        == """
┌───────┬───────────┬───────┐
│     1 │         2 │     3 │
├───────┼─────┬─────┼───────┤
│     3 │ 4.1 │ 4.2 │     5 │
│       ├─────┼─────┤       │
│       │ 4.3 │ 4.4 │       │
├───────┼─────┴─────┼───────┤
│     6 │         7 │     8 │
├───────┼───────────┼───────┤
│     9 │        10 │    11 │
├───────┼─────┬─────┼───────┤
│     1 │   2 │   3 │    14 │
├───┬───┼─────┴─────┤       │
│ 2 │ 3 │         1 │       │
├───┴───┼─────┬─────┼───┬───┤
│    15 │   1 │   2 │ 2 │ 1 │
│       │     ├─────┼───┤   │
│       │     │   3 │ 3 │   │
└───────┴─────┴─────┴───┴───┘
""".strip()
    )
    assert (
        table.stringify(theme=Themes.thin_double)
        == """
┌───────┬───────────┬───────┐
│     1 │         2 │     3 │
╞═══════╪═════╤═════╪═══════╡
│     3 │ 4.1 │ 4.2 │     5 │
│       ├─────┼─────┤       │
│       │ 4.3 │ 4.4 │       │
├───────┼─────┴─────┼───────┤
│     6 │         7 │     8 │
├───────┼───────────┼───────┤
│     9 │        10 │    11 │
├───────┼─────┬─────┼───────┤
│     1 │   2 │   3 │    14 │
├───┬───┼─────┴─────┤       │
│ 2 │ 3 │         1 │       │
├───┴───┼─────┬─────┼───┬───┤
│    15 │   1 │   2 │ 2 │ 1 │
│       │     ├─────┼───┤   │
│       │     │   3 │ 3 │   │
└───────┴─────┴─────┴───┴───┘
""".strip()
    )
    assert (
        table.stringify(theme=Themes.thin_thick)
        == """
┌───────┬───────────┬───────┐
│     1 │         2 │     3 │
┝━━━━━━━┿━━━━━┯━━━━━┿━━━━━━━┥
│     3 │ 4.1 │ 4.2 │     5 │
│       ├─────┼─────┤       │
│       │ 4.3 │ 4.4 │       │
├───────┼─────┴─────┼───────┤
│     6 │         7 │     8 │
├───────┼───────────┼───────┤
│     9 │        10 │    11 │
├───────┼─────┬─────┼───────┤
│     1 │   2 │   3 │    14 │
├───┬───┼─────┴─────┤       │
│ 2 │ 3 │         1 │       │
├───┴───┼─────┬─────┼───┬───┤
│    15 │   1 │   2 │ 2 │ 1 │
│       │     ├─────┼───┤   │
│       │     │   3 │ 3 │   │
└───────┴─────┴─────┴───┴───┘
""".strip()
    )
    assert (
        table.stringify(theme=Themes.markdown, end="\n")
        == """
|     1 |         2 |     3 |
|-------|-----------|-------|
|     3 | 4.1 | 4.2 |     5 |
|       |-----+-----|       |
|       | 4.3 | 4.4 |       |
|     6 |         7 |     8 |
|     9 |        10 |    11 |
|     1 |   2 |   3 |    14 |
|---+---|-----+-----|       |
| 2 | 3 |         1 |       |
|    15 |   1 |   2 | 2 | 1 |
|       |     +-----|---+   |
|       |     |   3 | 3 |   |
""".lstrip()
    )
    assert repr(Themes.thin) == "Themes.thin"
    custom_theme = Theme("custom_theme", Themes.rounded.border, Themes.thin)
    assert (
        table.stringify(theme=custom_theme)
        == """
╭───────┬───────────┬───────╮
│     1 │         2 │     3 │
├───────┼─────┬─────┼───────┤
│     3 │ 4.1 │ 4.2 │     5 │
│       ├─────┼─────┤       │
│       │ 4.3 │ 4.4 │       │
├───────┼─────┴─────┼───────┤
│     6 │         7 │     8 │
├───────┼───────────┼───────┤
│     9 │        10 │    11 │
├───────┼─────┬─────┼───────┤
│     1 │   2 │   3 │    14 │
├───┬───┼─────┴─────┤       │
│ 2 │ 3 │         1 │       │
├───┴───┼─────┬─────┼───┬───┤
│    15 │   1 │   2 │ 2 │ 1 │
│       │     ├─────┼───┤   │
│       │     │   3 │ 3 │   │
╰───────┴─────┴─────┴───┴───╯
""".strip()
    )
    assert (
        repr(custom_theme)
        == """
Theme('custom_theme', Border(horizontal='─', vertical='│', top_left='╭', 
top_right='╮', bottom_left='╰', bottom_right='╯', vertical_left='├', 
vertical_right='┤', top_horizontal='┬', bottom_horizontal='┴', central='┼', 
vertical_left_plus='├', horizontal_plus='─', central_plus='┼', 
vertical_right_plus='┤', top_horizontal_plus='┬', 
bottom_horizontal_plus='┴'), Themes.thin)
""".strip().replace(
            "\n", ""
        )
    )

    assert Themes.get("thin") == Themes.thin
    assert Themes.get("th1n", Themes.rounded) == Themes.rounded
    assert Themes.get("get") == Themes.ascii_thin


def test_border_colors():
    table = Table(
        [
            ("2", "4"),
            ("5", "6"),
        ],
        name="Table",
        column_names=("1", "3"),
    )
    table_with_red_border = """
\x1b[31m┌───────┐\x1b[0m
\x1b[31m│\x1b[0m Table \x1b[31m│\x1b[0m
\x1b[31m├───┬───┤\x1b[0m
\x1b[31m│\x1b[0m 1 \x1b[31m│\x1b[0m 3 \x1b[31m│\x1b[0m
\x1b[31m┝━━━┿━━━┥\x1b[0m
\x1b[31m│\x1b[0m 2 \x1b[31m│\x1b[0m 4 \x1b[31m│\x1b[0m
\x1b[31m├───┼───┤\x1b[0m
\x1b[31m│\x1b[0m 5 \x1b[31m│\x1b[0m 6 \x1b[31m│\x1b[0m
\x1b[31m└───┴───┘\x1b[0m
""".strip()
    with Themes.thin_thick.border.set_context_color("\x1b[31m"):
        assert table.stringify(theme=Themes.thin_thick) == table_with_red_border
    with Themes.thin_thick.border.set_context_color(Color.RED):
        assert table.stringify(theme=Themes.thin_thick) == table_with_red_border
    with Themes.thin_thick.border.set_context_color((255, 0, 0)):
        assert table.stringify(
            theme=Themes.thin_thick
        ) == table_with_red_border.replace("\x1b[31m", "\x1b[38;2;255;0;0m")
